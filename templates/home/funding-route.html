{% extends "base.html" %} {% load static %} 
{% block css %}

  <style>

    svg{
      cursor: pointer;
    }

  </style>

{% endblock %}
{% block search %}

<input
  class="form-control me-2"
  type="search"
  placeholder="Search"
  aria-label="Search"
  id="myInput"
/>

{% endblock %} {% block content %}

<div class="container-fluid" style="max-width: 1500px">
  <!-- Row 1 -->
  <div class="row">
    <div class="col-lg-12 d-flex align-items-strech w-100">
      <div class="card w-100">
        <div class="card-body">
          {% for message in messages %}
          <div
            class="alert {{ message.tags }} alert-dismissible fade show"
            role="alert"
          >
            {{ message }}
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="alert"
              aria-label="Close"
            ></button>
          </div>
          {% endfor %}
          <div
            class="d-sm-flex d-block align-items-center justify-content-between mb-9"
          >
            <div class="mb-3 mb-sm-0">
              <a href="{% url 'app:funding_route' %}">
                <h5
                  class="card-title fw-semibold text-primary text-decoration-underline"
                >
                  Funding Route
                </h5></a
              >
            </div>
            <div class="mb-3 mb-sm-0">
              <!-- Button trigger modal -->
              <button
                type="button"
                class="btn btn-primary position-relative mb-3"
                data-bs-toggle="modal"
                data-bs-target="#fundingroute"
              >
                <i class="bi bi-plus-lg"></i> Funding Route
              </button>

              <!-- Modal -->
              <div
                class="modal fade"
                id="fundingroute"
                data-bs-backdrop="static"
                data-bs-keyboard="false"
                tabindex="-1"
                aria-labelledby="staticBackdropLabel"
                aria-hidden="true"
              >
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h1 class="modal-title fs-5" id="staticBackdropLabel">
                        Add Funding Route
                      </h1>
                      <button
                        type="button"
                        class="btn-close"
                        data-bs-dismiss="modal"
                        aria-label="Close"
                      ></button>
                    </div>
                    <form
                      method="post"
                      action="/add_funding_route"
                    >
                      {% csrf_token %}
                      <div class="modal-body">
                        <div class="mb-3">
                          <label for="name" class="form-label">Name</label>
                          <input
                            type="text"
                            class="form-control"
                            id="name"
                            name="name"
                          />
                        </div>
                        <div class="mb-3">
                          <label for="managedby" class="form-label"
                            >Managed By</label
                          >
                          <input
                            type="text"
                            class="form-control"
                            id="managedby"
                            name="managed_by"
                          />
                        </div>
                        <div class="mb-3">
                          <label for="maincontact" class="form-label"
                            >Main Contact</label
                          >
                          <input
                            type="text"
                            class="form-control"
                            id="maincontact"
                            name="main_contact"
                          />
                        </div>
                        <div class="mb-3">
                          <label for="email" class="form-label">email</label>
                          <input
                            type="email"
                            class="form-control"
                            id="email"
                            name="email"
                          />
                        </div>
                        <div class="mb-3">
                          <label for="telephone" class="form-label"
                            >Telephone</label
                          >
                          <input
                            type="text"
                            class="form-control"
                            id="telephone"
                            name="telephone"
                          />
                        </div>
                      </div>
                      <div class="modal-footer">
                        <button
                          type="button"
                          class="btn btn-secondary"
                          data-bs-dismiss="modal"
                        >
                          Close
                        </button>
                        <button type="submit" class="btn btn-primary">
                          Submit
                        </button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div>
            
            <table class="table">
              <thead>
                <tr>
                  <th onclick="sortTable(0)">
                    Funding Route <span id="arrow0"></span>
                  </th>
                  <th>Stage</th>
                </tr>
              </thead>

              <tbody id="myTable">
                {% if routes %} {% for route in routes %}

                <tr>
                  <td class="text-underlined" style="width: 20%">
                    {{ route.name }}
                  </td>
                  <td style="width: 20%">
                    <form action="/{{ route.id }}/stages">
                      <button
                        type="submit"
                        class="position-relative btn btn-secondary"
                        style="right: 15px"
                        data-bs-dismiss="modal"
                      >
                        Stage
                      </button>
                    </form>
                  </td>
                  <td style="width: 20%">
                    
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="text-warning icon icon-tabler icon-tabler-pencil"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        stroke-width="2"
                        stroke="currentColor"
                        fill="none"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        data-bs-toggle="modal"
                data-bs-target="#editfundingroute{{ forloop.counter }}"
                      >
                        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                        <path
                          d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4"
                        />
                        <path d="M13.5 6.5l4 4" />
                      </svg>

                      <div
                class="modal fade"
                id="editfundingroute{{ forloop.counter }}"
                data-bs-backdrop="static"
                data-bs-keyboard="false"
                tabindex="-1"
                aria-labelledby="staticBackdropLabel"
                aria-hidden="true"
              >
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h1 class="modal-title fs-5" id="staticBackdropLabel">
                        Edit Funding Route
                      </h1>
                      <button
                        type="button"
                        class="btn-close"
                        data-bs-dismiss="modal"
                        aria-label="Close"
                      ></button>
                    </div>
                    <form
                      method="post"
                      action="/edit_funding_route/{{ route.id }}"
                    >
                      {% csrf_token %}
                      <div class="modal-body">
                        <div class="mb-3">
                          <label for="name" class="form-label">Name</label>
                          <input
                            type="text"
                            class="form-control"
                            id="name"
                            name="name"
                            value="{{ route.name }}"
                          />
                        </div>
                        <div class="mb-3">
                          <label for="managedby" class="form-label"
                            >Managed By</label
                          >
                          <input
                            type="text"
                            class="form-control"
                            id="managedby"
                            name="managed_by"
                            value="{{ route.managed_by }}"
                          />
                        </div>
                        <div class="mb-3">
                          <label for="maincontact" class="form-label"
                            >Main Contact</label
                          >
                          <input
                            type="text"
                            class="form-control"
                            id="maincontact"
                            name="main_contact"
                            value="{{ route.main_contact }}"
                          />
                        </div>
                        <div class="mb-3">
                          <label for="email" class="form-label">email</label>
                          <input
                            type="email"
                            class="form-control"
                            id="email"
                            name="email"
                            value="{{ route.email }}"
                          />
                        </div>
                        <div class="mb-3">
                          <label for="telephone" class="form-label"
                            >Telephone</label
                          >
                          <input
                            type="text"
                            class="form-control"
                            id="telephone"
                            name="telephone"
                            value="{{ route.telephone }}"
                          />
                        </div>
                      </div>
                      <div class="modal-footer">
                        <button
                          type="button"
                          class="btn btn-secondary"
                          data-bs-dismiss="modal"
                        >
                          Close
                        </button>
                        <button type="submit" class="btn btn-primary">
                          Submit
                        </button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>

                  </td>
                  <td style="width: 20%">
                    <a
                      href="#"
                      class="delete-funding_route-btn"
                      data-funding_route-id="{{ route.id }}"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="text-danger icon icon-tabler icon-tabler-trash"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        stroke-width="2"
                        stroke="currentColor"
                        fill="none"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      >
                        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                        <path d="M4 7l16 0" />
                        <path d="M10 11l0 6" />
                        <path d="M14 11l0 6" />
                        <path
                          d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12"
                        />
                        <path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3" />
                      </svg>
                    </a>
                  </td>
                </tr>
                {% endfor %} {% else %}
                <tr
                  class="text-center display-flex align-items-center justify-content-center"
                >
                  <td colspan="6" class="text-center">No Funding Route</td>
                </tr>
                {% endif %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock content %} {% block js %}

<script>
  $(document).ready(function () {
    $("#myInput").on("keyup", function () {
      var value = $(this).val().toLowerCase();
      $("#myTable tr").filter(function () {
        $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
      });
    });
  });

  function sortTable(colIndex) {
    var table,
      rows,
      switching,
      i,
      x,
      y,
      shouldSwitch,
      dir,
      switchcount = 0;
    table = document.getElementById("myTable");
    switching = true;
    dir = "asc"; // Set the sorting direction to ascending by default

    while (switching) {
      switching = false;
      rows = table.rows;
      for (i = 0; i < rows.length - 1; i++) {
        shouldSwitch = false;
        x = rows[i].getElementsByTagName("td")[colIndex];
        y = rows[i + 1].getElementsByTagName("td")[colIndex];
        if (dir === "asc") {
          if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
            shouldSwitch = true;
            break;
          }
        } else if (dir === "desc") {
          if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
            shouldSwitch = true;
            break;
          }
        }
      }
      if (shouldSwitch) {
        rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
        switching = true;
        switchcount++;
      } else {
        if (switchcount === 0 && dir === "asc") {
          dir = "desc";
          switching = true;
        }
      }
    }
  }
</script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const cdeleteButtons = document.querySelectorAll(".delete-funding_route-btn");
    cdeleteButtons.forEach((cbutton) => {
      cbutton.addEventListener("click", function (event) {
        event.preventDefault();
        const funding_routeId = cbutton.getAttribute("data-funding_route-id");
        const confirmDelete = confirm(
          "Are you sure you want to delete this funding_route?"
        );

        if (confirmDelete) {
          window.location.href = `/remove_funding_route/${funding_routeId}`;
        }
      });
    });
  });
</script>

{% endblock js %}
