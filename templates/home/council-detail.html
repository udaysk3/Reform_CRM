{% extends 'base.html' %} {% load static %} {% block content %}


<div class="row container-fluid">
  <div class="cnav-item fs-6 col-1">
    <a class="btn btn-primary fs-6 " href="/council-detail/{{prev.id}}"><svg xmlns="http://www.w3.org/2000/svg"
        width="20" height="20" fill="currentColor" class="bi bi-arrow-left" viewBox="0 0 16 16">
        <path fill-rule="evenodd"
          d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8" />
      </svg></a>
  </div>
  <div class="cnav-item fs-6 col-10">
    <span class="col"> <b>Local Authority</b> - </span> {{ council.name }}
  </div>
  <div class="cnav-item fs-6 col-1">
    <a class="btn btn-primary fs-6" href="/council-detail/{{next.id}}"><svg xmlns="http://www.w3.org/2000/svg"
        width="20" height="20" fill="currentColor" class="bi bi-arrow-right" viewBox="0 0 16 16">
        <path fill-rule="evenodd"
          d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8" />
      </svg></a>
  </div>



  <div class="container-fluid pt-4">
      {% for message in messages %}
      <div class="alert {{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
      {% endfor %}

      <div class="card p-0">
        <div class="card-body p-3 m-0">
          <div class="row">
            <div class="col-sm-6 mb-3 mb-sm-0">
              <div class="card m-0">
                <div class="card-body m-0">
                  
                  <h6 class="mt-3">Key Events</h6>
                  <div class="card p-0 m-0">
                    <div class="card-body p-3 m-0" style="height: 150px; overflow-y: auto">
                      <b>{{ council.created_at }}</b> Funding Route Added by {{ council.agent.first_name }} {{
                      council.agent.last_name }}
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-sm-6">
              <div class="card m-0">
                <div class="card-body">
                  <div class="d-grid gap-2 d-md-block">
                    <!-- Button trigger modal -->
                    <button type="button" class="btn btn-primary position-relative mb-3" style="right:-70%"
                      data-bs-toggle="modal" data-bs-target="#fundingroute">
                      <i class="bi bi-plus-lg"></i> Funding Route
                    </button>

                    <!-- Modal -->
                    <div class="modal fade" id="fundingroute" data-bs-backdrop="static" data-bs-keyboard="false"
                      tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                      <div class="modal-dialog">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h1 class="modal-title fs-5" id="staticBackdropLabel">Select Funding Route</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                          </div>
                          <form method='post' action="/add_council_funding_route/{{ council.id }}">
                            {% csrf_token %}
                            <div class="modal-body">
                              <select class="form-select" aria-label="Default select example" name="route">
                                {% for route in routes %}
                                <option value="{{ route.id }}">{{ route.name }}</option>
                                {% endfor %}
                              </select>
                            </div>
                            <div class="modal-footer">
                              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                              <button type="submit" class="btn btn-primary">Submit</button>
                            </div>
                          </form>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="card p-0 m-0">
                    <div class="card-body p-3 m-0" style="height: 390px; overflow-y: auto">

                      {% for route in c_routes %}

                       <div class="col-sm-4 mt-3" style="width: 100%">
                        <div class="card m-0 ">
                          <div class="card-body row">
                            <div class="col-10">
                            <h6><b>Name : </b> {{route.name}}</h6>
                            <h6><b>Email</b> : {{route.email}}</h6>
                            <h6><b>Telephone</b> : {{route.telephone}}</h6>
                            </div>
                          </div>
                        </div>
                      </div> 
                      {% endfor %}

                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
    </div>
  </div>


  {% endblock %} {% block js %}

  <script scr="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>

  <script src="{% static 'node_modules/jquery-clock-timepicker/jquery-clock-timepicker.min.js' %}"></script>
  <script>


    function DoSubmit() {
      document.action_submit_form.date_field.value = document.action_submit_form.date_field.value.split("-").reverse().join("-");
      return confirm(date);
    }


    document.addEventListener("DOMContentLoaded", function () {
      const editButtons = document.querySelectorAll(".edit-council-btn");
      editButtons.forEach((button) => {
        button.addEventListener("click", function (event) {
          event.preventDefault();
          const councilId = button.getAttribute("data-council-id");
          window.location.href = `/council?page=edit_council&id=${councilId}`;
        });
      });

      const deleteButtons = document.querySelectorAll(".delete-council-btn");
      deleteButtons.forEach((button) => {
        button.addEventListener("click", function (event) {
          event.preventDefault();
          const councilId = button.getAttribute("data-council-id");
          const confirmDelete = confirm(
            "Are you sure you want to delete this council?"
          );
          if (confirmDelete) {
            window.location.href = `/remove_council/${councilId}`;
          }
        });
      });
    });

    var currentDate = new Date();
    var londonDate = currentDate.toLocaleString('en-GB', { timeZone: 'Europe/London' });
    var formattedDate = londonDate.split(", ")[0].split("/").join("-");
    var formattedTime = londonDate.split(", ")[1].split(":");

    const dates = document.querySelectorAll(".date");
    const time = document.querySelectorAll(".time");

    $(function () {
      $("#date_field").datepicker({
        dateFormat: "dd-mm-yy"
        , duration: "fast",
        minDate: formattedDate
      });
    });


    $('.time').clockTimePicker({
      duration: true,
      durationNegative: false,
      alwaysSelectHoursFirst: true,
      colors: {
        buttonTextColor: 'black',
        clockFaceColor: '#F1F1F1',
        clockInnerCircleTextColor: '#000',
        clockInnerCircleUnselectableTextColor: '#000',

      },
      precision: 5,
      i18n: {
        cancelButton: 'Cancle',
      },
    });

    dates.forEach((date) => {
      date.value = formattedDate;
      console.log(date.value);
    });

    time.forEach((time) => {
      time.value = `${formattedTime[0]}:${formattedTime[1]}`;
    });

    const model_btn = document.querySelectorAll('.model-btn');

    model_btn.forEach(el => {

      el.addEventListener('click', (e) => {

        let myModal = new bootstrap.Modal(

        el.nextElementSibling,
        {}
      );

      myModal.show();

        
      })
      
      

    });

    
    


    

  </script>


  {% endblock %}