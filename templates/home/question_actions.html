{% extends 'base.html' %} {% load static %} {% load custom %} {% block content %}

<div class="row container-fluid">
  {% for message in messages %}
  <div
    class="alert {{ message.tags }} alert-dismissible fade show"
    role="alert"
  >
    {{ message }}
    <button
      type="button"
      class="btn-close"
      data-bs-dismiss="alert"
      aria-label="Close"
    ></button>
  </div>
  {% endfor %}

  <div class="col">
    <button
      type="button"
      class="btn btn-primary position-absolute"
      style="right: 50px"
      data-bs-toggle="modal"
      data-bs-target="#questionModal"
    >
      Add Question
    </button>

    <div
      class="modal fade"
      id="questionModal"
      data-bs-backdrop="static"
      data-bs-keyboard="false"
      tabindex="-1"
      aria-labelledby="staticBackdropLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <form action="{% url 'app:add_question' %}" method="post">
            {% csrf_token %}
            <div class="modal-header">
              <h1 class="modal-title fs-5" id="staticBackdropLabel">
                Add Question
              </h1>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <div class="mb-3">
                <label for="question" class="form-label">Question</label>
                <input
                  type="text"
                  class="form-control"
                  id="question"
                  placeholder="Question"
                  name="question"
                />
              </div>
              <input type="hidden" name="type">
              <div class="mb-3">
                <select
                  class="form-select"
                  id="name"
                  name="type"
                  onchange="checkSeletcted(this)"
                >
                  <option value="text">Text</option>
                  <option value="checkbox">Checkbox</option>
                  <option value="date">Date</option>
                  <option value="email">Email</option>
                  <option value="month">Month</option>
                  <option value="number">Number</option>
                  <option value="password">Password</option>
                  <option value="time">Time</option>
                  <option value="url">URL</option>
                  <option value="dropdown">Dropdown</option>
                </select>
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Close
              </button>
              <button class="btn btn-primary">Submit</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <div
      class="row-6"
      style="overflow-y: scroll; max-height: 250px; margin-top: 40px"
    >
      <div class="container-fluid pt-4">
        <div class="card p-0">
          <div class="card-body p-3 m-0">
            <table class="table">
              <thead>
                <tr>
                  <th>Questions</th>
                </tr>
              </thead>

              <tbody id="myTable">
                {% if questions %} {% for product in questions %}

                <tr>
                  <td class="text-underlined" style="width: 20%">
                    {{ product.question }}
                  </td>
                  <td style="width: 10%">
                    <button
                      type="button"
                      class="btn btn-primary"
                      data-bs-toggle="modal"
                      data-bs-target="#questionModal{{ forloop.counter }}"
                    >
                      Edit Question
                    </button>
                  
                    <div
                      class="modal fade"
                      id="questionModal{{ forloop.counter }}"
                      data-bs-backdrop="static"
                      data-bs-keyboard="false"
                      tabindex="-1"
                      aria-labelledby="staticBackdropLabel"
                      aria-hidden="true"
                    >
                      <div class="modal-dialog">
                        <div class="modal-content">
                          <form action="{% url 'app:edit_question' product.id %}" method="post">
                            {% csrf_token %}
                            <div class="modal-header">
                              <h1 class="modal-title fs-5" id="staticBackdropLabel">
                                Edit Question
                              </h1>
                              <button
                                type="button"
                                class="btn-close"
                                data-bs-dismiss="modal"
                                aria-label="Close"
                              ></button>
                            </div>
                            <div class="modal-body">
                              <div class="mb-3">
                                <label for="question" class="form-label">Question</label>
                                <input
                                  type="text"
                                  class="form-control"
                                  id="question"
                                  placeholder="Question"
                                  name="question"
                                  value="{{ product.question }}"
                                />
                              </div>
                              <input type="hidden" name="type" value="{{ product.type }}">
                              <div class="mb-3">
                                <select
                                  class="form-select"
                                  id="name"
                                  name="type"
                                  onchange="checkSeletcted(this)"
                                >
                                  <option {% if product.type == 'text' %} selected {% endif %} value="text">Text</option>
                                  <option {% if product.type == 'checkbox' %} selected {% endif %} value="checkbox">Checkbox</option>
                                  <option {% if product.type == 'date' %} selected {% endif %} value="date">Date</option>
                                  <option {% if product.type == 'email' %} selected {% endif %} value="email">Email</option>
                                  <option {% if product.type == 'month' %} selected {% endif %} value="month">Month</option>
                                  <option {% if product.type == 'number' %} selected {% endif %} value="number">Number</option>
                                  <option {% if product.type == 'password' %} selected {% endif %} value="password">Password</option>
                                  <option {% if product.type == 'time' %} selected {% endif %} value="time">Time</option>
                                  <option {% if product.type == 'url' %} selected {% endif %} value="url">URL</option>
                                  <option {% if 'dropdown' in product.type %} selected {% endif %} value="dropdown">Dropdown</option>
                                </select>
                                {% if 'dropdown' in product.type %}
                                {% with all_fields=product.type|firstsplit:',' %}
                                {% with fields=all_fields.1|split:',' %}
                                {% for option in fields %}
                                <div class="my-3 row ms-3">
                                  <input type="text" class="col-sm-2" placeholder="Option" name="dynamic_option" value="{{ option }}">
                                  <a href="#" class="option add-option-btn col-sm-2" onclick="addOption(this)">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="text-success icon icon-tabler icon-tabler-plus" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                      <line x1="12" y1="5" x2="12" y2="19" />
                                      <line x1="5" y1="12" x2="19" y2="12" />
                                    </svg>
                                  </a>
                                  <a href="#" class="delete-user-btn col-sm-2" onclick="deleteField(this)">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="text-danger icon icon-tabler icon-tabler-trash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                      <path d="M4 7l16 0" />
                                      <path d="M10 11l0 6" />
                                      <path d="M14 11l0 6" />
                                      <path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12" />
                                      <path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3" />
                                    </svg>
                                  </a>
                                </div>
                                {% endfor %}
                                {% endwith %}
                                {% endwith %}
                                {% endif %}
                              </div>
                            </div>
                            <div class="modal-footer">
                              <button
                                type="button"
                                class="btn btn-secondary"
                                data-bs-dismiss="modal"
                              >
                                Close
                              </button>
                              <button class="btn btn-primary">Submit</button>
                            </div>
                          </form>
                        </div>
                      </div>
                    </div>
                  </td>
                  <td style="width: 10%">
                    <a
                      href="{% url 'app:delete_question' product.id %}"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="text-danger icon icon-tabler icon-tabler-trash"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        stroke-width="2"
                        stroke="currentColor"
                        fill="none"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      >
                        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                        <path d="M4 7l16 0" />
                        <path d="M10 11l0 6" />
                        <path d="M14 11l0 6" />
                        <path
                          d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12"
                        />
                        <path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3" />
                      </svg>
                    </a>
                  </td>
                </tr>
                {% endfor %} {% else %}
                <tr
                  class="text-center display-flex align-items-center justify-content-center"
                >
                  <td colspan="6" class="text-center">
                    No Questions Available
                  </td>
                </tr>
                {% endif %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <button
      type="button"
      class="btn btn-primary position-absolute mt-2"
      style="right: 50px"
      data-bs-toggle="modal"
      data-bs-target="#actionModal"
    >
      Add Action
    </button>

    <div
      class="modal fade"
      id="actionModal"
      data-bs-backdrop="static"
      data-bs-keyboard="false"
      tabindex="-1"
      aria-labelledby="staticBackdropLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <form action="{% url 'app:add_action' %}" method="post">
            {% csrf_token %}
            <div class="modal-header">
              <h1 class="modal-title fs-5" id="staticBackdropLabel">
                Add Action
              </h1>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <div class="mb-3">
                <label for="action" class="form-label">Action</label>
                <input
                  type="text"
                  class="form-control"
                  id="action"
                  placeholder="Action"
                  name="action"
                />
              </div>
              <div class="mb-3">
                <label for="script" class="form-label">Script</label>
                <textarea class="form-control" id="script" rows="3" name="type"></textarea>
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Close
              </button>
              <button class="btn btn-primary">Submit</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <div
      class="row-6"
      style="overflow-y: scroll; max-height: 250px; margin-top: 50px"
    >
      <div class="container-fluid pt-4">
        <div class="card p-0">
          <div class="card-body p-3 m-0">
            <table class="table">
              <thead>
                <tr>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="myTable">
                {% if actions %} {% for product in actions %}
                <tr>
                  <td class="text-underlined" style="width: 20%">
                    {{ product.action }}
                  </td>
                  <td style="width: 10%">
                    <button
                      type="button"
                      class="btn btn-primary"
                      data-bs-toggle="modal"
                      data-bs-target="#actionModal{{ forloop.counter }}"
                    >
                      Edit Question
                    </button>
                  
                    <div
                      class="modal fade"
                      id="actionModal{{ forloop.counter }}"
                      data-bs-backdrop="static"
                      data-bs-keyboard="false"
                      tabindex="-1"
                      aria-labelledby="staticBackdropLabel"
                      aria-hidden="true"
                    >
                      <div class="modal-dialog">
                        <div class="modal-content">
                          <form action="{% url 'app:edit_action' product.id %}" method="post">
                            {% csrf_token %}
                            <div class="modal-header">
                              <h1 class="modal-title fs-5" id="staticBackdropLabel">
                                Edit Question
                              </h1>
                              <button
                                type="button"
                                class="btn-close"
                                data-bs-dismiss="modal"
                                aria-label="Close"
                              ></button>
                            </div>
                            <div class="modal-body">
                              <div class="mb-3">
                                <label for="action" class="form-label">Action</label>
                                <input
                                  type="text"
                                  class="form-control"
                                  id="action"
                                  placeholder="Action"
                                  name="action"
                                  value="{{ product.action }}"
                                />
                              </div>
                              <div class="mb-3">
                                <label for="script" class="form-label">Script</label>
                                <textarea class="form-control" id="script" rows="3" name="script">{{ product.script }}</textarea>
                              </div>
                            </div>
                            <div class="modal-footer">
                              <button
                                type="button"
                                class="btn btn-secondary"
                                data-bs-dismiss="modal"
                              >
                                Close
                              </button>
                              <button class="btn btn-primary">Submit</button>
                            </div>
                          </form>
                        </div>
                      </div>
                    </div>
                  </td>
                  <td style="width: 10%">
                    <a
                      href="{% url 'app:delete_action' product.id %}"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="text-danger icon icon-tabler icon-tabler-trash"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        stroke-width="2"
                        stroke="currentColor"
                        fill="none"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      >
                        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                        <path d="M4 7l16 0" />
                        <path d="M10 11l0 6" />
                        <path d="M14 11l0 6" />
                        <path
                          d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12"
                        />
                        <path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3" />
                      </svg>
                    </a>
                  </td>
                </tr>
                {% endfor %} {% else %}
                <tr
                  class="text-center display-flex align-items-center justify-content-center"
                >
                  <td colspan="6" class="text-center">No Actions Available</td>
                </tr>
                {% endif %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %} {% block js %}

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const cdeleteButtons = document.querySelectorAll(".delete-product-btn");
    cdeleteButtons.forEach((cbutton) => {
      cbutton.addEventListener("click", function (event) {
        event.preventDefault();
        const productId = cbutton.getAttribute("data-product-id");
        const confirmDelete = confirm(
          "Are you sure you want to delete this product?"
        );

        if (confirmDelete) {
          window.location.href = `/remove_funding_route/${productId}`;
        }
      });
    });
  });

  function checkSeletcted(e) {
    let selected = e.value;
    if (selected == "dropdown") {
      const addOption = document.createElement("div");
      addOption.classList.add("my-3", "row", "ms-3");
      addOption.innerHTML = `
      <input type="text" class="col-sm-2" placeholder="Option" name="dynamic_option">
      <a href="#" class="option add-option-btn col-sm-2" onclick="addOption(this)">
        <svg xmlns="http://www.w3.org/2000/svg" class="text-success icon icon-tabler icon-tabler-plus" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
          <line x1="12" y1="5" x2="12" y2="19" />
          <line x1="5" y1="12" x2="19" y2="12" />
        </svg>
      </a>
      <a href="#" class="delete-user-btn col-sm-2" onclick="deleteField(this)">
        <svg xmlns="http://www.w3.org/2000/svg" class="text-danger icon icon-tabler icon-tabler-trash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
          <path d="M4 7l16 0" />
          <path d="M10 11l0 6" />
          <path d="M14 11l0 6" />
          <path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12" />
          <path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3" />
        </svg>
      </a>
    `;
      e.parentElement.parentElement.appendChild(addOption);
    }
  }

  function addOption(e) {
    const newOption = document.createElement("div");
    newOption.classList.add("my-3", "row", "ms-3");
    newOption.innerHTML = `
    <input type="text" class="col-sm-2" placeholder="Option" name="dynamic_option">
    <a href="#" class="option add-option-btn col-sm-2" onclick="addOption(this)">
      <svg xmlns="http://www.w3.org/2000/svg" class="text-success icon icon-tabler icon-tabler-plus" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
        <line x1="12" y1="5" x2="12" y2="19" />
        <line x1="5" y1="12" x2="19" y2="12" />
      </svg>
    </a>
    <a href="#" class="delete-user-btn col-sm-2" onclick="deleteField(this)">
      <svg xmlns="http://www.w3.org/2000/svg" class="text-danger icon icon-tabler icon-tabler-trash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
        <path d="M4 7l16 0" />
        <path d="M10 11l0 6" />
        <path d="M14 11l0 6" />
        <path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12" />
        <path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3" />
      </svg>
    </a>
  `;
    e.parentElement.insertAdjacentElement("afterEnd", newOption);
  }

  function deleteField(e) {
    e.parentElement.remove();
  }

  const forms = document.querySelectorAll("form");
  forms.forEach((form) => {
    form.addEventListener("submit", () => {
      const options = form.querySelectorAll(".option");
      console.log(options[0].parentElement.parentElement.children[1]);
      options[0].parentElement.parentElement.children[1].value = 'dropdown';
      options.forEach((option) => {

        option.parentElement.parentElement.children[1].value =
        option.parentElement.parentElement.children[1].value +
        "," +
        option.parentElement.children[0].value;
        console.log(option.parentElement.parentElement.children[1].value);
      });
      if (options.length > 0) {
        form.querySelector('select').remove()
      }
    });
  });
</script>

{% endblock %}